<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Verificación de Productos</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

  <div class="w-full max-w-md bg-gray-800 rounded-xl p-4 shadow-lg space-y-4">
    <h1 id="product-title" class="text-xl font-bold text-center">Producto 1: Código #001</h1>
    
    <div class="relative aspect-video bg-black rounded overflow-hidden">
      <video id="video" class="absolute inset-0 w-full h-full object-cover hidden" autoplay playsinline></video>
      <canvas id="canvas" class="hidden absolute inset-0 w-full h-full object-cover"></canvas>
    </div>

    <div class="flex flex-col sm:flex-row gap-2 justify-center">
      <button id="btn-tomar" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">Activar Cámara</button>
      <button id="btn-enviar" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded hidden">Tomar y Enviar</button>
      <div class="flex justify-center">
  <button id="btn-reiniciar" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">Reiniciar</button>
</div>

    </div>

    <label class="flex items-center gap-2">
      <input type="checkbox" id="no-existe" class="form-checkbox text-yellow-500" />
      El producto no existe
    </label>

    <div class="flex justify-center">
      <button id="btn-enviar-texto" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded hidden">Enviar Sin Foto</button>
    </div>
  </div>

  <script>
  const TELEGRAM_BOT_TOKEN = "8185977764:AAHle7yRhwRn8S_vrDWSIfCg6L4WRiGWk3o";
  const TELEGRAM_CHAT_ID = "5094779934";

  const productos = [
{ titulo: "DIESEL FUEL FOR LIFE H 125ML-5LAL5715100", codigo: "81648" },
{ titulo: "C.HERRERA 212 SEXY MEN EDT 100ML", codigo: "80582" },
{ titulo: "STELLA DUSTIN LA PRIERE EDP FEM 100ML", codigo: "377929" },
{ titulo: "MARINA B-30002 ROUGE ROYAL EDP 50ML SP", codigo: "3672" },
{ titulo: "YSL-225110 CINEMA EDP 90ML SP FEMME", codigo: "80563" },
{ titulo: "GIORGIO ARMANI ACQUA DI GIO ABSOLU EDP 15ML", codigo: "350711" },
{ titulo: "MYSTICAL 1 BILLION MEN KIT 88ML", codigo: "376040" },
{ titulo: "GUERLAIN MONGELAN MINI 3X5 ML EDP+1X 5ML EDT", codigo: "391464" },
{ titulo: "T. MUGLER-41401 ANGEL BODY LOTION 200ML", codigo: "81560" },
{ titulo: "MERCEDES BENZ MINI THE MOVE 20ML EDT M TRAVEL COLL 116885", codigo: "403382" },
{ titulo: "MIRADA SQUARED MAN EDT 100ML", codigo: "407836" },
{ titulo: "HERMES H24 KIT 12.5ML EDT+ 100ML EDT RFBL", codigo: "417432" },
{ titulo: "MERCEDES BENZ AIR 100ML", codigo: "415626" },
{ titulo: "HUGO BOSS FEMME EDP 75ML-47207", codigo: "1657" },
{ titulo: "AFNAN SUPREMACY GOLD EDP 100ML", codigo: "401150" },
{ titulo: "NEW BRAND PREST.SWEETIE WOMAN 100ML 61224", codigo: "345335" },
{ titulo: "ORIENTICA ROUGE KIT EDP 80ML", codigo: "392736" },
{ titulo: "CHLOE COLLECTION MINI-73974", codigo: "283670" },
{ titulo: "MERCEDES BENZ MINI SELECT 20ML EDT M TRAVEL COLL 116884", codigo: "403379" },
{ titulo: "MERCEDES BENZ CLUB BLACK 3.4 EDT M +3.4 S/G (METAL SET) 123075", codigo: "403363" },
{ titulo: "GALAXY PLUS CONCEP PERFUME SPRAY MISS 200ML-B8046", codigo: "370429" },
{ titulo: "ISSEY MIYAKE NUIT DEO MEN 150ML", codigo: "379148" },
{ titulo: "HERMÈS EAU DE NARCISSE BLEU 100ML", codigo: "391470" },
{ titulo: "CUBA GREEN 35ML 2174", codigo: "2063" },
{ titulo: "GALAXY PERFUME SPRAY 200ML - ROUGE", codigo: "423582" },
{ titulo: "MERCEDES BENZ MINI MAN 20ML EDT M TRAV COLLT 116882", codigo: "403371" },
{ titulo: "MARXZELLE GLAM HEEL GLITTER PINK SPARKLE 90ML", codigo: "424324" },
{ titulo: "NARCISO RODRIGUEZ NARCISO CRISTAL EDP 50ML", codigo: "374596" },
{ titulo: "NEW BRAND PREST.STRONG MEN 100ML 60818", codigo: "345334" },
{ titulo: "RALPH LAUREN POLO BLACK EDT 40ML", codigo: "80379" },
{ titulo: "HERMES TERRE D'HERMES KIT 12.5+ 75ML EDP+ 40ML AS", codigo: "417434" },
{ titulo: "PARIS ROYALE BEST CHOICE EDT 100 ML", codigo: "417692" },
{ titulo: "LANCOME IDOLE AURA 25ML EDP", codigo: "391483" },
{ titulo: "C.HERRERA GOOD GIRL PROBADOR 80ML", codigo: "315518" },
{ titulo: "MAISON ALHAMBRA GLACIER BELLA 100ML", codigo: "423735" },
{ titulo: "GUCCI BLOOM AMBROSIA DI FIORI 100ML", codigo: "370942" },
{ titulo: "HERMÈS EAU DE MANDARINE AMBRÉE 100ML", codigo: "391469" },
{ titulo: "PUCCINI SENSUALITY EDP 100ML", codigo: "420979" },
{ titulo: "MYSTICAL BOOS THE SCENT FEMME  KIT 88ML", codigo: "376041" },
{ titulo: "GIORGIO ARMANI MY WAY KIT EDP 90ML", codigo: "388377" },
{ titulo: "NARCISO RODRIGUEZ FOR HER EDT KIT 100ML", codigo: "331324" },
{ titulo: "PERFUME IS EXCESS MEN EDT 100ML", codigo: "325417" },
{ titulo: "MOSCHINO TOY 2 PEARL KIT 100ML-8011003893867", codigo: "424736" },
{ titulo: "GUCCI BAMBOO EAU DE PARFUM 75ML", codigo: "201680" },
{ titulo: "MONT BLANC SIGNATURE FEME EDP 90ML", codigo: "362415" },
{ titulo: "CUBA SI PODEMOS WOMAN 35ML", codigo: "2084" },
{ titulo: "RALPH LAUREN POLO BLUE EDT 200ML", codigo: "80345" },
{ titulo: "PERFUMES PROBADORES OUTLET MEDIUM VARIOS", codigo: "337568" },
{ titulo: "T. MUGLER-1021709 ANGEL EDP 100ML", codigo: "80642" },
{ titulo: "VINCI - DEO-SPRAY - SEA MAN 150ML", codigo: "424257" },
{ titulo: "ELIE SAAB LE PARFUM ROYAL EDP 90ML PROBADOR", codigo: "388810" },
{ titulo: "LATTAFA ASAD ZANZIBAR EDP 100ML", codigo: "415692" },
{ titulo: "ROYAL MARINA DIAMOND KIT 100ML+BODY-NESSEC.28018", codigo: "183489" },
{ titulo: "YSL LIBRE 7,5ML EDP+50ML EDP RFBL+ POUCH", codigo: "417874" },
{ titulo: "GRES CABOCHARD FEM 100ML", codigo: "338234" },
{ titulo: "RALPH LAUREN POLO DEEP BLUE EDP 40ML", codigo: "417852" },
{ titulo: "LACOSTE ORIGINAL MEN EDP 100ML", codigo: "424158" },
{ titulo: "P.RABANNE ONE MILLION ROYAL EDP 100ML", codigo: "393331" },
{ titulo: "PRADA INFUSION FLEUR D'ORA FEM 100ML-44759", codigo: "281717" },
{ titulo: "ZIRCONIA PRIVE- FAIRY TALE FEM EDP 100ML", codigo: "377610" },
{ titulo: "LANCOME LA NUIT TRESOR NUDE EDT 50ML", codigo: "417459" },
{ titulo: "NEW BRAND GOLF BLACK MASCULINO 100ML-2369364", codigo: "280665" },
{ titulo: "STELLA DUSTIN 2X30ML RED SUN SLVER STAR", codigo: "377935" },
{ titulo: "YSL -Y MEN EDT 100ML", codigo: "309965" },
{ titulo: "NEW BRAND PREST.DANI WOMEN 100ML", codigo: "386655" },
{ titulo: "MYSTICAL CHENALE BLUE MEN KIT 88ML", codigo: "376035" },
{ titulo: "B. SPEARS FANTASY MIDNIGHT KIT 100ML", codigo: "80881" },
{ titulo: "VERSACE BRIGHT CRYSTAL 90ML", codigo: "1847" },
{ titulo: "ED HARDY HOMBRE EDT TUBO TIGRE 100ML-EHMF00003", codigo: "364810" },
{ titulo: "NEW BRAND GOLF BLUE 100ML", codigo: "2201" },
{ titulo: "BOULEVARD CHAMP DE MARS FOR MEN EDP 100ML", codigo: "384149" },
{ titulo: "C.DIOR SAUVAGE PARFUM(MAS CONCENTRADO)60ML-0456", codigo: "337999" },
{ titulo: "MB PERFUMS  BRIGHT LIGHTS EDP 100ML", codigo: "424348" },
{ titulo: "MAISON ALHAMBRA AURA D´ECLAT", codigo: "410703" },
{ titulo: "E.ARDEN SUNFLOWERS PROBADOR 100ML", codigo: "339279" },
{ titulo: "FRAGLUXE BAD GIRL FEM 100ML", codigo: "402927" },
{ titulo: "MOSCHINO I LOVE LOVE WOMEN EDP 100ML", codigo: "400452" },
{ titulo: "C.DIOR EAU SAUVAGE EDT 100ML", codigo: "314167" },
{ titulo: "VERSACE POUR HOMME EDT 100ML", codigo: "80917" },
{ titulo: "MONT BLANC LEGEND NIGHT EDP 100ML", codigo: "80501" },
{ titulo: "HERMÈS EAU DES MERVEILLES BLEUE 100ML", codigo: "391472" },
{ titulo: "GUCCI GUILTY BLACK EDT 90ML", codigo: "201673" },
{ titulo: "HERMÈS EAU DE NARCISSE BLEU 100ML", codigo: "391470" },
{ titulo: "RALPH LAUREN POLO BLUE EDT 125ML", codigo: "80373" },
{ titulo: "PRADA INFUSION D´IRIS 100ML", codigo: "80371" },
{ titulo: "S.T.DUPONT 09001665 PARFUM D´EXCEPTION EDP 100ML", codigo: "376592" },
{ titulo: "YSL LIBRE INTENSE 100ML EDP FEMME", codigo: "80671" },
{ titulo: "MAISON ALHAMBRA  CAPRICE NOIR 100ML", codigo: "423737" },
{ titulo: "GUESS SEDUCED FEMME EDT 100ML", codigo: "391501" },
{ titulo: "KENZO HOMME EDP 100ML", codigo: "388010" },
{ titulo: "CAROLINA HERRERA 212 VIP MEN EDP 100ML", codigo: "343044" },
{ titulo: "TOMMY HILFIGER TOMMY GIRL EDT 100ML", codigo: "80625" },
{ titulo: "TOM FORD BLACK ORCHID 50ML", codigo: "81152" },
{ titulo: "VERSACE EROS 100ML", codigo: "80355" },
{ titulo: "YSL BLACK OPIUM 50ML EDP", codigo: "372505" },
{ titulo: "PACO RABANNE 1 MILLION EDT 100ML", codigo: "80375" },
{ titulo: "CHANEL COCO MADEMOISELLE EDP 100ML", codigo: "80568" },
{ titulo: "RALPH LAUREN POLO BLUE EDT 75ML", codigo: "80357" },
{ titulo: "DOLCE GABBANA LIGHT BLUE WOMEN EDT 100ML", codigo: "370012" },
{ titulo: "TOM FORD NOIR 100ML EDP", codigo: "376839" },
{ titulo: "DIESEL FUEL FOR LIFE 100ML EDT", codigo: "80346" },
{ titulo: "ARMANI CODE ABSOLU EDP 75ML", codigo: "370046" },
{ titulo: "VERSACE POUR HOMME EDT 75ML", codigo: "80349" },
{ titulo: "GUCCI BLOOM EDP 100ML", codigo: "370944" },
{ titulo: "CAROLINA HERRERA 212 MEN EDT 100ML", codigo: "80579" },
{ titulo: "BURBERRY BRIT WOMEN EDT 100ML", codigo: "80455" },
{ titulo: "CHANEL CHANCE EDP 100ML", codigo: "80569" },
{ titulo: "LOEWE 001 WOMEN EDP 100ML", codigo: "403267" },
{ titulo: "LANCOME LA VIE EST BELLE 100ML", codigo: "80561" },
{ titulo: "VERSACE EROS 200ML EDT", codigo: "80354" },
{ titulo: "TOM FORD NOIR EXTREME EDP 100ML", codigo: "376840" },
{ titulo: "HUGO BOSS BOTTLED NIGHT EDP 100ML", codigo: "80597" },
{ titulo: "GUCCI GUILTY ABSOLUTE POUR HOMME 90ML", codigo: "370941" },
{ titulo: "TOMMY HILFIGER TOMMY EDT 100ML", codigo: "80623" },
{ titulo: "HUGO BOSS THE SCENT EDP 100ML", codigo: "80618" },
{ titulo: "RALPH LAUREN POLO RED EDT 75ML", codigo: "80360" },
{ titulo: "DOLCE GABBANA THE ONE EDP 100ML", codigo: "370011" },
{ titulo: "CAROLINA HERRERA GOOD GIRL EDP 80ML", codigo: "315521" },
{ titulo: "RALPH LAUREN POLO BLUE EDT 40ML", codigo: "80378" },
{ titulo: "DOLCE GABBANA LIGHT BLUE MEN EDT 125ML", codigo: "370013" },
{ titulo: "DIESEL FUEL FOR LIFE 125ML EDT", codigo: "80347" },
{ titulo: "GUCCI GUILTY ABSOLUTE POUR FEMME 90ML", codigo: "370943" },
{ titulo: "CHANEL COCO MADEMOISELLE EDP 50ML", codigo: "80567" },
{ titulo: "HUGO BOSS ORANGE MEN EDT 100ML", codigo: "80594" },
{ titulo: "GUESS SEDUCED MEN EDT 100ML", codigo: "391499" },
{ titulo: "YSL L'HOMME EDT 100ML", codigo: "80565" },
{ titulo: "YSL BLACK OPIUM EDP 90ML", codigo: "372504" },
{ titulo: "DIESEL FUEL FOR LIFE 75ML EDT", codigo: "80345" },
{ titulo: "GUCCI GUILTY POUR HOMME EDT 90ML", codigo: "201675" },
{ titulo: "RALPH LAUREN POLO RED EDT 125ML", codigo: "80361" },
{ titulo: "CAROLINA HERRERA 212 VIP ROSÉ EDP 80ML", codigo: "343045" },
{ titulo: "GUCCI BAMBOO EDP 50ML", codigo: "201679" },
{ titulo: "HUGO BOSS BOTTLED EDP 100ML", codigo: "80596" },
{ titulo: "RALPH LAUREN POLO BLACK EDT 125ML", codigo: "80380" },
{ titulo: "GUCCI GUILTY POUR FEMME EDT 75ML", codigo: "201678" },
{ titulo: "DOLCE GABBANA LIGHT BLUE WOMEN EDT 50ML", codigo: "370010" },
{ titulo: "TOM FORD BLACK ORCHID EDP 100ML", codigo: "81153" },
{ titulo: "RALPH LAUREN POLO BLUE EDT 125ML", codigo: "80374" },
{ titulo: "DIESEL FUEL FOR LIFE 50ML EDT", codigo: "80344" },
{ titulo: "CAROLINA HERRERA 212 VIP MEN EDT 80ML", codigo: "343046" },
{ titulo: "YSL LIBRE EDP 50ML", codigo: "417873" },
{ titulo: "GUCCI GUILTY POUR HOMME EDT 50ML", codigo: "201677" },
{ titulo: "HUGO BOSS THE SCENT EDT 100ML", codigo: "80617" },
{ titulo: "RALPH LAUREN POLO RED EDT 40ML", codigo: "80359" },
{ titulo: "CAROLINA HERRERA 212 MEN EDT 80ML", codigo: "80580" }
];

  let index = parseInt(localStorage.getItem("productoIndex")) || 0;

  let streamActivo = false;

  const video = document.getElementById("video");
  const canvas = document.getElementById("canvas");
  const btnTomar = document.getElementById("btn-tomar");
  const btnEnviar = document.getElementById("btn-enviar");
  const btnEnviarTexto = document.getElementById("btn-enviar-texto");
  const chkNoExiste = document.getElementById("no-existe");
  const titulo = document.getElementById("product-title");

  chkNoExiste.addEventListener("change", () => {
    btnEnviarTexto.classList.toggle("hidden", !chkNoExiste.checked);
  });

  btnTomar.addEventListener("click", async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: { ideal: "environment" } } // Cámara trasera
      });
      video.srcObject = stream;
      video.classList.remove("hidden");
      canvas.classList.add("hidden");
      btnEnviar.classList.remove("hidden");
      streamActivo = true;
    } catch (err) {
      alert("Permiso denegado o cámara no disponible");
    }
  });

  btnEnviar.addEventListener("click", () => {
    // Mostrar ventana emergente "Enviando..."
    const loading = window.open("", "enviando", "width=300,height=100");
    loading.document.write("<p style='font-family:sans-serif;text-align:center;margin-top:30px;'>📤 Enviando foto...</p>");

    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext("2d").drawImage(video, 0, 0);
    canvas.classList.remove("hidden");

    canvas.toBlob(blob => {
      const { titulo, codigo } = productos[index];
      const formData = new FormData();
      formData.append("chat_id", TELEGRAM_CHAT_ID);
      formData.append("caption", `${titulo} - Código: ${codigo}`);
      formData.append("photo", blob, "foto.jpg");

      fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, {
        method: "POST",
        body: formData
      }).then(() => {
        if (loading) loading.close();
        detenerCamara();
        avanzar();
      });
    });
  });
const btnReiniciar = document.getElementById("btn-reiniciar");

btnReiniciar.addEventListener("click", () => {
  if (confirm("¿Estás seguro de que quieres reiniciar la lista?")) {
    localStorage.removeItem("productoIndex");
    location.reload(); // Refresca para aplicar el cambio
  }
});
  btnEnviarTexto.addEventListener("click", () => {
    const { titulo, codigo } = productos[index];
    const mensaje = `❌ El producto NO EXISTE\n${titulo} - Código: ${codigo}`;

    fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        chat_id: TELEGRAM_CHAT_ID,
        text: mensaje
      })
    }).then(() => {
      detenerCamara();
      avanzar();
    });
  });

  function detenerCamara() {
    if (streamActivo && video.srcObject) {
      video.srcObject.getTracks().forEach(track => track.stop());
      video.srcObject = null;
    }
    video.classList.add("hidden");
    btnEnviar.classList.add("hidden");
    streamActivo = false;
  }

  function avanzar() {
    index++;
    localStorage.setItem("productoIndex", index);
    canvas.classList.add("hidden");
    btnEnviarTexto.classList.add("hidden");
    chkNoExiste.checked = false;

    if (index < productos.length) {
      const { titulo: t, codigo } = productos[index];
      titulo.textContent = `${t}: Código #${codigo}`;
    } else {
      titulo.textContent = "✅ Todos los productos han sido procesados";
      btnTomar.disabled = true;
      chkNoExiste.disabled = true;
    }
  }
</script>

</body>
</html>
